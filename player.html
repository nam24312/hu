<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ph√°t video (YouTube + Rumble)</title>
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <style>
    body{
      background:#111;
      color:#fff;
      font-family:sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      height:100vh;
      margin:0;
    }
    .container{
      max-width:800px;
      aspect-ratio:16/9;
      width:100%;
    }
    /* Kh√¥ng crop iframe ƒë·ªÉ c·∫£ YouTube & Rumble hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß */
    .plyr__video-embed iframe{
      width:100%;
      height:100%;
      position:relative;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="plyr__video-embed" id="player">
    <iframe src="" allowfullscreen allow="autoplay"></iframe>
  </div>
</div>

<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script>
(function(){
  const params = new URLSearchParams(location.search);
  let raw = params.get('video') || '';

// üö´ Ch·∫∑n n·∫øu video ch·ª©a URL tr·ªè ng∆∞·ª£c v·ªÅ ch√≠nh site ho·∫∑c l·ªìng qu√° nhi·ªÅu https
if ((raw || '').includes('nam24312.github.io') || (raw.match(/https?:\/\//g) || []).length > 1) {
  document.body.innerHTML =
    '<h2 style="text-align:center">üö´ Link kh√¥ng h·ª£p l·ªá!</h2>';
  throw new Error('Blocked: nested URL');
}

  let provider = 'youtube';
  let id = '';

  /* ---------------- Helpers ---------------- */
  const detectProvider = url => {
    if (/rumble\.com/.test(url)) return 'rumble';
    if (/youtu\.?be/.test(url))  return 'youtube';
    return '';
  };

  const ytId = url => {
    try{
      const u = new URL(url);
      if (u.hostname.includes('youtu.be'))          return u.pathname.slice(1);
      if (u.pathname.startsWith('/embed/'))        return u.pathname.split('/embed/')[1];
      return u.searchParams.get('v');
    }catch{ return url; }
  };

  const rumbleId = url => {
    try{
      const u = new URL(url);
      if (u.pathname.startsWith('/embed/'))        return u.pathname.split('/embed/')[1];
      const m = u.pathname.match(/\/v([0-9a-z]+)/i);
      if (m) return m[1];
    }catch{}
    return url.replace(/[^0-9a-z]/gi,'');
  };

  /* ------------- Parse video param ------------ */
  if (raw.includes('http')) {
    provider = detectProvider(raw);
    if (provider==='youtube')  id = ytId(raw);
    else if (provider==='rumble') id = rumbleId(raw);
  } else {
    // raw ch·ªâ l√† ID; cho ph√©p ?p=rumble ƒë·ªÉ ch·ªâ ƒë·ªãnh
    provider = params.get('p') || (raw.length>11 ? 'rumble' : 'youtube');
    id = raw;
  }

  /* ------------ Embed iframe --------------- */
  const iframe = document.querySelector('#player iframe');
  if (provider==='youtube'){
    iframe.src = `https://www.youtube.com/embed/${id}?rel=0&modestbranding=1&showinfo=0&enablejsapi=1`;
    new Plyr('#player');
  } else if (provider==='rumble'){
    iframe.src = `https://rumble.com/embed/${id}/?rel=0`;
  } else {
    document.body.innerHTML = '<h2 style="text-align:center">‚ùì Kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c n·ªÅn t·∫£ng!</h2>';
    return;
  }
})();
</script>
</body>
</html>
